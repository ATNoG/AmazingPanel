<% content_for :head do %>
  <%= javascript_include_tag 'highcharts/highcharts.js' %>  
  <%= javascript_include_tag 'highcharts/themes/custom.js' %>  
  <%= javascript_include_tag 'codemirror/base/codemirror' %>  
  <%= javascript_include_tag 'jquery.tmpl.min.js' %>
<% end %>

<% content_for :sub_actions do %> 
  <%= sub_toolbar do %>
    <% unless (@experiment.status == 0) %>
      <%= add_image_action(experiment_path(@experiment)+"?reset",
                           'clear.png', 'Reset', { :method => "put" }) %>
    <% end %>
  <% end %>
<% end %>

<% content_for :content do %>
  <%= render :partial => 'details' %>
  <hr/>
  <%= render :partial => 'env' %> 
<% end %>

<% content_for :footer do %>
  <%= modal_dialog("", "modal-dialog") %>
<% end %>

<% content_for :bottom_scripts do %>
  <%= render :partial => 'env_templates' %>
  <script>    
    function onChange(){
      var code = "<%= raw escape_javascript(@experiment.ed.code) %>";
      var sizeo = this.historySize();
      var current_content = this.editor.getCode();
      var equal = (code == current_content);
      if (sizeo.undo > 0 && !equal){
        $("#changes_warning").show();
      } else {
        $("#changes_warning").hide();
      }
    }
    
    function onSave(){
    }
    <%= render :partial => 'library/eds/codemirror.js', :locals => { :target => 'code', :readonly => false, :change => "onChange"} %>
  <%= render :partial => 'resources_map.js' %>
  <% if @experiment.preparing? or @experiment.started? %>
    experimentStat();  
  <% end %>  
  </script>
<% end %>
<!--
  $(".pane").hide();
  $(".pane:eq(0)").show();
  $(".pane-links > a:first-child").addClass("pane-link-active");
  $(".pane-links a").live('click', function(evt){
      var active_tab = $($(this).attr("href"));
      $(".pane").hide();
      $(".pane-links > a").removeClass("pane-link-active");
      $(this).addClass("pane-link-active");
      active_tab.fadeIn();
      active_tab.focus();
      return false;
  });
  -->
