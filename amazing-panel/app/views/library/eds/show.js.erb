<% if params.has_key?("nodes") %>
  $(".node").removeClass("available");  
  <% @allowed.each do |n| %>
    $("#node-<%= n %>").addClass("available");  
  <% end %>
<% else %>
$("#ed-<%= @ed.id %>").html("<p><%= escape_javascript(text_area_tag(:code, @content.readlines, :cols => 0, :rows => 30)) %></p>")
if (CodeMirror != undefined){
  CodeMirror.fromTextArea('code', {
    parserfile: ["../tokenizeruby.js", "../parseruby.js"],
    stylesheet: "/stylesheets/codemirror/rubycolors.css",
    path: "/javascripts/codemirror/base/",
    lineNumbers: false,
    textWrapping: true,
    indentUnit: 2,
    parserConfig: {},
    readOnly: true,
    height: "465px",
    width: "100%"
  }, 0);
}
<% end %>
